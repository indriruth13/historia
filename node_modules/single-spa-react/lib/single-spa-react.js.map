{"version":3,"sources":["../src/single-spa-react.js"],"names":[],"mappings":"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","file":"single-spa-react.js","sourcesContent":["/* We don't import parcel.component.js from this file intentionally. See comment\n * in that file for why\n */\n\n// React context that gives any react component the single-spa props\nexport let SingleSpaContext = null\n\nconst defaultOpts = {\n  // required opts\n  React: null,\n  ReactDOM: null,\n  rootComponent: null,\n  loadRootComponent: null,\n  suppressComponentDidCatchWarning: false,\n\n  // optional opts\n  domElementGetter: null,\n  parcelCanUpdate: true, // by default, allow parcels created with single-spa-react to be updated\n}\n\nexport default function singleSpaReact(userOpts) {\n  if (typeof userOpts !== 'object') {\n    throw new Error(`single-spa-react requires a configuration object`);\n  }\n\n  const opts = {\n    ...defaultOpts,\n    ...userOpts,\n  };\n\n  if (!opts.React) {\n    throw new Error(`single-spa-react must be passed opts.React`);\n  }\n\n  if (!opts.ReactDOM) {\n    throw new Error(`single-spa-react must be passed opts.ReactDOM`);\n  }\n\n  if (!opts.rootComponent && !opts.loadRootComponent) {\n    throw new Error(`single-spa-react must be passed opts.rootComponent or opts.loadRootComponent`);\n  }\n\n  if (!SingleSpaContext && opts.React.createContext) {\n    SingleSpaContext = opts.React.createContext()\n  }\n\n  const lifecycles = {\n    bootstrap: bootstrap.bind(null, opts),\n    mount: mount.bind(null, opts),\n    unmount: unmount.bind(null, opts),\n  };\n\n  if (opts.parcelCanUpdate) {\n    lifecycles.update = update.bind(null, opts)\n  }\n\n  return lifecycles\n}\n\nfunction bootstrap(opts, props) {\n  if (opts.rootComponent) {\n    // This is a class or stateless function component\n    return Promise.resolve()\n  } else {\n    // They passed a promise that resolves with the react component. Wait for it to resolve before mounting\n    return opts\n      .loadRootComponent()\n      .then(resolvedComponent => {\n        opts.rootComponent = resolvedComponent\n      })\n  }\n}\n\nfunction mount(opts, props) {\n  return new Promise((resolve, reject) => {\n\n    if (!opts.suppressComponentDidCatchWarning && atLeastReact16(opts.React)) {\n      if (!opts.rootComponent.prototype) {\n        console.warn(`single-spa-react: ${props.name || props.appName || props.childAppName}'s rootComponent does not have a prototype.  If using a functional component, wrap it in an error boundary or other class that implements componentDidCatch to avoid accidentally unmounting the entire single-spa application`)\n      } else if (!opts.rootComponent.prototype.componentDidCatch) {\n        console.warn(`single-spa-react: ${props.name || props.appName || props.childAppName}'s rootComponent should implement componentDidCatch to avoid accidentally unmounting the entire single-spa application.`);\n      }\n    }\n\n    const domElementGetter = chooseDomElementGetter(opts, props)\n\n    if (typeof domElementGetter !== 'function') {\n      throw new Error(`single-spa-react: the domElementGetter for react application '${props.appName || props.name}' is not a function`)\n    }\n\n    const whenFinished = function() {\n      resolve(this);\n    };\n\n\n    const rootComponentElement = opts.React.createElement(opts.rootComponent, props)\n    const elementToRender = SingleSpaContext ? opts.React.createElement(SingleSpaContext.Provider, {value: props}, rootComponentElement) : rootComponentElement\n    const domElement = getRootDomEl(domElementGetter, props)\n    const renderedComponent = reactDomRender({elementToRender, domElement, whenFinished, opts})\n    opts.domElement = domElement\n  })\n}\n\nfunction unmount(opts, props) {\n  return Promise\n    .resolve()\n    .then(() => {\n      opts.ReactDOM.unmountComponentAtNode(opts.domElement);\n    })\n}\n\nfunction update(opts, props) {\n  return new Promise((resolve, reject) => {\n    const whenFinished = function() {\n      resolve(this);\n    };\n\n    const rootComponentElement = opts.React.createElement(opts.rootComponent, props)\n    const elementToRender = SingleSpaContext ? opts.React.createElement(SingleSpaContext.Provider, {value: props}, rootComponentElement) : rootComponentElement\n    const renderedComponent = reactDomRender({elementToRender, domElement:opts.domElement, whenFinished, opts})\n  })\n}\n\nfunction getRootDomEl(domElementGetter, props) {\n  const el = domElementGetter();\n  if (!el) {\n    throw new Error(`single-spa-react: domElementGetter function for application '${props.appName || props.name}' did not return a valid dom element. Please pass a valid domElement or domElementGetter via opts or props`);\n  }\n\n  return el;\n}\n\nfunction atLeastReact16(React) {\n  if (React && typeof React.version === 'string' && React.version.indexOf('.') >= 0) {\n    const majorVersionString = React.version.slice(0, React.version.indexOf('.'));\n    try {\n      return Number(majorVersionString) >= 16;\n    } catch(err) {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\nfunction chooseDomElementGetter(opts, props) {\n  props = props && props.customProps ? props.customProps : props\n  if (props.domElement) {\n    return () => props.domElement\n  } else if (props.domElementGetter) {\n    return props.domElementGetter\n  } else if (opts.domElementGetter) {\n    return opts.domElementGetter\n  } else {\n    return defaultDomElementGetter(props)\n  }\n}\n\nfunction defaultDomElementGetter(props) {\n  const htmlId = `single-spa-application:${props.appName || props.name}`\n  if (!htmlId) {\n    throw Error(`single-spa-react was not given an application name as a prop, so it can't make a unique dom element container for the react application`)\n  }\n\n  return function defaultDomEl() {\n    let domElement = document.getElementById(htmlId)\n    if (!domElement) {\n      domElement = document.createElement('div')\n      domElement.id = htmlId\n      document.body.appendChild(domElement)\n    }\n\n    return domElement\n  }\n}\n\nfunction reactDomRender({opts, elementToRender, domElement, whenFinished}) {\n  if(opts.renderType === 'createRoot') {\n    return opts.ReactDOM.createRoot(domElement).render(elementToRender, whenFinished)\n  }\n\n  if(opts.renderType === 'hydrate') {\n    return opts.ReactDOM.hydrate(elementToRender, domElement, whenFinished)\n  }\n\n  // default to this if 'renderType' is null or doesn't match the other options\n  return opts.ReactDOM.render(elementToRender, domElement, whenFinished)\n}\n"]}